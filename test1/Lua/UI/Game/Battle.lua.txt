
local BattleUI = nil    -- 进入游戏的界面句柄




-- 开始游戏
function StartBattle(lastUI)

    -- 加载界面prefab
    BattleUI = CSLoadAndInstantiatePrefabUI(AssetUIGamePath,AssetUIGamePath.."/Battle")
    
    -- 加载场景
    
    -- 加载模型
    --local monster1 = CSLoadAndInstantiatePrefabGameObject(AssetMonsterPath.."/Tauren",AssetMonsterPath.."/Tauren")
    --local monster1 = CSLoadAndInstantiatePrefabGameObject(AssetMonsterPath.."/1qinglong",AssetMonsterPath.."/1qinglong")
    --local monster2 = CSLoadAndInstantiatePrefabGameObject(AssetMonsterPath.."/2baihu",AssetMonsterPath.."/2baihu")


    --local animator1 = monster1:GetComponent(typeof(CS.UnityEngine.Animator))
    --local animator1 = monster1:GetComponentInChildren(typeof(CS.UnityEngine.Animator))
    --MyTimer:after(5, function()         animator1:SetTrigger("attack")        print("attack")    end)
    --MyTimer:after(10, function()         animator1:SetTrigger("run")        print("run")    end)
    --MyTimer:after(13, function()         animator1:SetTrigger("stoprun")        print("stoprun")    end)
    --MyTimer:after(15, function()         animator1:SetTrigger("hit")        print("hit")    end)
    --MyTimer:after(20, function()         animator1:SetTrigger("sp1")        print("sp1")    end)
    --MyTimer:after(25, function()         animator1:SetTrigger("sp2")        print("sp2")    end)
    --MyTimer:after(30, function()         animator1:SetTrigger("dead")        print("dead")    end)
    

    --local animator2 = monster2:GetComponent(typeof(CS.UnityEngine.Animator))
    --MyTimer:after(25, function()         animator2:SetTrigger("attack")        print("attack")    end)
    --MyTimer:after(30, function()         animator2:SetTrigger("sp")        print("sp")    end)
    --MyTimer:after(35, function()         animator2:SetTrigger("hit")        print("hit")    end)
    --MyTimer:after(40, function()         animator2:SetTrigger("dead")        print("dead")    end)
    --

    -- 关闭上一个界面
    if lastUI~=nil then
        CSDestroyGameObject(lastUI)       -- 销毁加载界面
    end


    --BattleInit("Lua/Battle/btJson/zsw2")
    --local battleTimer = MyTimer:every(0.5 , function()        BattleUpdate(0.5)   end)
    --MyTimer:after(5, function()        MyTimer:cancel(battleTimer)    end)
    
    -- 生成中间位置的牛头人
    local tauren = Character:New()
    tauren:LoadGameObject("Tauren")
    tauren.Speed = 6
    tauren:BTRootInit("Lua/Battle/btJson/zsw2")
    tauren.Model.transform.localPosition = CS.UnityEngine.Vector3(0, 0, 0);
    
    -- 设定相机跟踪中间位置的角色
    local camera = CSFindGameObject("CM vcam2")
    print("设定相机"..camera.name)
    local virtualCamera = camera:GetComponent(typeof(CS.Cinemachine.CinemachineVirtualCamera))
    virtualCamera.Follow = tauren.Model.transform       -- 绑定到中间位置的角色上面去

    
    -- 生成最右侧的
    local Gnome = Character:New()
    Gnome:LoadGameObject("Gnome")
    Gnome.Speed = 3.5
    Gnome:BTRootInit("Lua/Battle/btJson/zsw2")
    Gnome.Model.transform.localPosition = CS.UnityEngine.Vector3(4, 0, 0);

    -- 生成最左侧的
    local Bloodelf = Character:New()
    Bloodelf:LoadGameObject("Bloodelf")
    Bloodelf.Speed = 4
    Bloodelf:BTRootInit("Lua/Battle/btJson/zsw2")
    Bloodelf.Model.transform.localPosition = CS.UnityEngine.Vector3(-4, 0, 0);

    -- 生成左二
    local Dwarf = Character:New()
    Dwarf:LoadGameObject("Dwarf")
    Dwarf.Speed = 4
    Dwarf:BTRootInit("Lua/Battle/btJson/zsw2")
    Dwarf.Model.transform.localPosition = CS.UnityEngine.Vector3(-2, 0, 0);

    -- 生成右二
    local Human = Character:New()
    Human:LoadGameObject("Human")
    Human.Speed = 5
    Human:BTRootInit("Lua/Battle/btJson/zsw2")
    Human.Model.transform.localPosition = CS.UnityEngine.Vector3(2, 0, 0);



    --DOtween = CS.DG.Tweening.DOTween
    --
    --local tween = tauren.Model.transform:DOMoveX(1,3)
    --tween:OnComplete(){
    --    print("move callback")
    --}
    
    

   
end


